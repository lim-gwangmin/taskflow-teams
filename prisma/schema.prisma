generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url       = env("PRISMA_DATABASE_URL") 
  directUrl = env("DATABASE_URL")
}

// ì´ë©”ì¼ ì¸ì¦ ìŠ¤í‚¤ë§ˆ
model VerificationToken {
  id                    String   @id @default(uuid())
  email                 String   @unique
  verificationCode      String   @unique
  expiresAt             DateTime

  @@map("verification_tokens")
}

// ìœ ì € ì •ë³´ ìŠ¤í‚¤ë§ˆ
model User {
  id          Int      @id @default(autoincrement())
  email       String   @unique
  password    String
  name        String?
  createdAt   DateTime @default(now())

  // --- ê´€ê³„ í•„ë“œ ---
  memberships Membership[] // ì´ ìœ ì €ê°€ ì†í•œ ê·¸ë£¹ ë©¤ë²„ì‹­ ëª©ë¡
  posts       Post[]       // ì´ ìœ ì €ê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ ëª©ë¡ (ìˆ˜ì •)
  
  @@map("users")
}

// ê·¸ë£¹ ì •ë³´ ìŠ¤í‚¤ë§ˆ
model Group {
  id          String        @id @default(uuid())
  seq         Int           @unique @default(autoincrement()) // ê³ ìœ í•œ ìˆ«ì ID
  name        String
  admin       String        
  createdAt   DateTime      @default(now())
  no          Int           @unique @default(autoincrement()) // ê·¸ë£¹ ìƒì„± ìˆœì„œ (ìµœì‹ /ì˜¤ë˜ëœìˆœ ì •ë ¬ìš©)

  // --- ê´€ê³„ í•„ë“œ ---
  memberships Membership[] // ì´ ê·¸ë£¹ì— ì†í•œ ë©¤ë²„ì‹­ ëª©ë¡
  posts       Post[]       // ì´ ê·¸ë£¹ì— ì‘ì„±ëœ ê²Œì‹œê¸€ ëª©ë¡
}

// ê¶Œí•œ Enum
enum Role {
  ADMIN
  MEMBER
  GUEST
  VIEWER
}

// user, group ì‚¬ì´ ê´€ê³„ì™€ ì—­í•  ì¤‘ê°„ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ
model Membership {
  userId    Int               // User.id(Int)ì™€ íƒ€ì… ì¼ì¹˜
  userEmail String            // User.email(String unique)ì™€ íƒ€ì… ì¼ì¹˜ 
  groupId   String            // Group.id(String)ì™€ íƒ€ì… ì¼ì¹˜
  groupSeq  Int               //  Group.seq(Int)ì™€ íƒ€ì… ì¼ì¹˜ (ìˆ«ì ID ì°¸ì¡°)

  // --- ê´€ê³„ í•„ë“œ ---
  user    User   @relation(fields: [userId], references: [id])
  group   Group  @relation(fields: [groupId], references: [id])
  role    Role

  // ë³µí•© ê¸°ë³¸ í‚¤ (Composite Primary Key)
  @@id([userId, groupId])
  // ğŸ”½ ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€ (groupId ëŒ€ì‹  groupSeqë¡œ ê·¸ë£¹ì„ íŠ¹ì •í•  ë•Œ ì‚¬ìš©)
  @@index([groupSeq])
}

// ê·¸ë£¹ ë‚´ ì‘ì„±í•œ ê¸€ ì •ë³´ ìŠ¤í‚¤ë§ˆ
model Post {
  id        String @id @default(uuid())
  title     String
  content   String
  
  authorId  Int    // User.id(Int)ì™€ íƒ€ì… ì¼ì¹˜ (ìˆ˜ì •)
  groupId   String // Group.id(String)ì™€ íƒ€ì… ì¼ì¹˜
  
  // --- ê´€ê³„ í•„ë“œ ---
  author    User   @relation(fields: [authorId], references: [id])
  group     Group  @relation(fields: [groupId], references: [id])
}